<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi"
     xmlns:util="http://schemas.microsoft.com/wix/UtilExtension">

  <Product Id="*"
           Name="win-acme"
           Language="1033"
           Version="$(var.ProductVersion)"
           Manufacturer="Ascensio System SIA"
           UpgradeCode="9E7A0E51-3F2D-4F77-A1E4-2C0C2B41A9F3">

    <Package InstallerVersion="500"
             Compressed="yes"
             InstallScope="perMachine" />

    <Property Id="ALLUSERS" Value="1" />

    <MajorUpgrade DowngradeErrorMessage="A newer version is already installed." />

    <MediaTemplate />

    <Feature Id="MainFeature" Title="win-acme" Level="1">
      <ComponentGroupRef Id="WinAcmeFiles"/>
      <ComponentRef Id="EnvAndAcl"/>
    </Feature>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLDIR" Name="win-acme">
          <Component Id="EnvAndAcl" Guid="*">
            <CreateFolder>
              <util:PermissionEx User="LOCAL SERVICE" GenericAll="yes" />
            </CreateFolder>

            <Environment Id="AddToSystemPath"
                         Name="PATH"
                         Value="[INSTALLDIR]"
                         Action="set"
                         Part="last"
                         System="yes"
                         Permanent="no" />

            <!-- KeyPath without registry -->
            <CreateFolder Id="KeyPathFolder" />
          </Component>
        </Directory>
      </Directory>
    </Directory>

  </Product>
</Wix>
